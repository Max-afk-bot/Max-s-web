<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Max — Ultimate Gaming Experience Page</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    /* ---------- THEME / LAYOUT ---------- */
    :root{
      --bg1: #070812;
      --bg2: #081026;
      --card: rgba(255,255,255,0.03);
      --muted: #9fb0d6;
      --accent: #39ff14;
      --accent2: #7c5cff;
      --glass: rgba(255,255,255,0.035);
      --radius: 14px;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#eaf6ff;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial}
    .container-max{max-width:1250px;margin:28px auto;padding:0 18px}
    .hero{
      border-radius:var(--radius); overflow:hidden; position:relative; padding:24px;
      background:linear-gradient(90deg, rgba(10,12,24,0.75), rgba(8,10,20,0.9));
      box-shadow:0 20px 60px rgba(2,6,23,0.6);
      display:flex;gap:18px;align-items:center; justify-content:space-between;
      min-height:220px;
    }
    .hero-left{flex:1}
    .hero-title{font-size:30px;font-weight:800;margin:0}
    .hero-sub{color:var(--muted);margin-top:6px}
    .hero-stats{display:flex;gap:10px;margin-top:16px;flex-wrap:wrap}
    .stat-pill{
      background:var(--card); padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);
      min-width:140px;text-align:center;box-shadow:0 8px 30px rgba(0,0,0,0.6);
    }
    .stat-num{font-size:20px;font-weight:800}
    .stat-label{color:var(--muted);font-size:12px}

    .hero-art{width:300px;text-align:right}
    .hero-art img{width:280px;border-radius:12px;box-shadow:0 18px 40px rgba(0,0,0,0.7)}

    /* ---------- GRID ---------- */
    .grid{display:grid;grid-template-columns:360px 1fr;gap:20px;margin-top:22px}
    @media (max-width: 990px){ .grid{grid-template-columns:1fr; } .hero-art{display:none} }

    /* ---------- SIDEBAR CARD ---------- */
    .card-panel{background:var(--card);border-radius:14px;padding:14px;border:1px solid rgba(255,255,255,0.03)}
    .section-title{font-weight:700;margin-bottom:8px}

    /* ---------- GAME CARD ---------- */
    .game-card{display:flex;gap:12px;align-items:flex-start;padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02)}
    .game-thumb{width:96px;height:64px;border-radius:10px;background-size:cover;background-position:center;flex-shrink:0;border:1px solid rgba(255,255,255,0.03)}
    .game-meta{flex:1}
    .badge-small{background:rgba(255,255,255,0.02);border-radius:999px;padding:6px 8px;font-size:12px;border:1px solid rgba(255,255,255,0.02)}
    .chip{display:inline-block;margin:4px 6px 4px 0;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));font-size:13px}

    /* ---------- TABLE ---------- */
    .table-wrap{margin-top:14px;border-radius:10px;overflow:auto;border:1px solid rgba(255,255,255,0.03)}
    table{width:100%;border-collapse:collapse;color:#eaf6ff}
    thead th{background:rgba(255,255,255,0.02);padding:12px 10px;text-align:left;color:var(--muted);position:sticky;top:0}
    tbody td{padding:12px 10px;border-top:1px solid rgba(255,255,255,0.02);vertical-align:middle}
    .small-muted{color:var(--muted);font-size:13px}

    /* ---------- CONTROLS ---------- */
    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#eaf6ff}
    .accent-line{height:6px;border-radius:6px;background:linear-gradient(90deg,var(--accent),var(--accent2));margin:18px 0}

    /* ---------- FOOTER ---------- */
    .footer-note{color:var(--muted);font-size:13px;margin-top:20px;text-align:center}

    /* ---------- EXTRA ---------- */
    .toggle-raw{cursor:pointer;color:var(--muted);font-size:13px}
    .hidden-numbers .raw-number{filter:blur(6px);user-select:none}
    .copy-small{font-size:12px;padding:6px 8px}
    .big-hr{height:1px;background:rgba(255,255,255,0.02);margin:12px 0;border-radius:2px}
  </style>
</head>
<body>

  <div class="container-max">

    <!-- HERO -->
    <div class="hero">
      <div class="hero-left">
        <div style="display:flex;align-items:center;gap:12px;">
          <img src="#" alt="avatar" style="width:64px;height:64px;border-radius:12px;object-fit:cover;border:1px solid rgba(255,255,255,0.04)">
          <div>
            <div class="hero-title">Max — Gaming Experience</div>
            <div class="hero-sub">Massive single-page portfolio: games, levels, achievements, total experience, charts & export — privacy-first (no live last-play data).</div>
          </div>
        </div>

        <div class="hero-stats">
          <div class="stat-pill">
            <div class="stat-num" id="ui-total-hours">—</div>
            <div class="stat-label">Total Playtime (hrs)</div>
          </div>
          <div class="stat-pill">
            <div class="stat-num" id="ui-games-count">—</div>
            <div class="stat-label">Games Listed</div>
          </div>
          <div class="stat-pill">
            <div class="stat-num" id="ui-top-genre">—</div>
            <div class="stat-label">Top Genre (by hrs)</div>
          </div>
          <div class="stat-pill">
            <div class="stat-num" id="ui-average-hours">—</div>
            <div class="stat-label">Avg Hrs / Game</div>
          </div>
        </div>

        <div style="margin-top:16px" class="controls">
          <button id="btn-load-sample" class="btn btn-primary"><i class="fa fa-dice"></i> Load Sample Data</button>
          <button id="btn-export-json" class="btn btn-outline-light btn-ghost"><i class="fa fa-download"></i> Export JSON</button>
          <button id="btn-export-csv" class="btn btn-outline-light btn-ghost"><i class="fa fa-file-csv"></i> Export CSV</button>
          <div class="ms-auto d-flex align-items-center gap-2">
            <label class="toggle-raw" title="Toggle showing raw numbers">Show numbers</label>
            <div class="form-check form-switch form-switch-md ms-2">
              <input class="form-check-input" type="checkbox" id="toggleRaw">
            </div>
          </div>
        </div>

      </div>

      <div class="hero-art">
        <img src="#" alt="cover image (replace #)">
      </div>
    </div>

    <div class="accent-line"></div>

    <!-- GRID: left sidebar (summary + top games + donut) and right (big charts + table) -->
    <div class="grid">

      <!-- LEFT SIDEBAR -->
      <div>

        <!-- TOP GAMES -->
        <div class="card-panel">
          <div class="section-title">Top Games (by hours)</div>
          <div id="top-games-list" style="display:flex;flex-direction:column;gap:10px"></div>
          <div class="big-hr"></div>
          <div class="section-title">Platforms & Links</div>
          <div id="platform-links" class="small-muted" style="line-height:1.4"></div>
        </div>

        <!-- GENRE DONUT -->
        <div class="card-panel" style="margin-top:14px">
          <div class="section-title">Genre Breakdown</div>
          <canvas id="genreDonut" height="240"></canvas>
        </div>

        <!-- ACHIEVEMENTS CLOUD -->
        <div class="card-panel" style="margin-top:14px">
          <div class="section-title">Achievements Cloud</div>
          <div id="achievements-cloud" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:6px"></div>
        </div>

      </div>

      <!-- RIGHT CONTENT -->
      <div>

        <!-- BIG CHARTS -->
        <div class="card-panel">
          <div class="d-flex justify-content-between align-items-center">
            <div class="section-title">Playtime Overview</div>
            <div class="small-muted">Hover charts to inspect; click legend to toggle</div>
          </div>

          <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:12px">
            <div style="flex:1;min-width:260px">
              <canvas id="hoursBar" height="150"></canvas>
            </div>
            <div style="flex:1;min-width:260px">
              <canvas id="monthlyLine" height="150"></canvas>
            </div>
          </div>
        </div>

        <!-- DETAILED TABLE -->
        <div class="card-panel" style="margin-top:14px">
          <div class="d-flex justify-content-between align-items-center">
            <div class="section-title">Detailed Games Table</div>
            <div>
              <button class="btn btn-sm btn-outline-light btn-ghost" id="btn-collapse-all"><i class="fa fa-compress"></i> Collapse</button>
              <button class="btn btn-sm btn-outline-light btn-ghost" id="btn-expand-all"><i class="fa fa-expand"></i> Expand</button>
            </div>
          </div>

          <div class="table-wrap mt-3 hidden-numbers" id="table-wrap">
            <table id="games-table" aria-describedby="gaming-table">
              <thead>
                <tr>
                  <th>Game</th>
                  <th>Level / Rank</th>
                  <th>Achievements</th>
                  <th>Playtime (hrs)</th>
                  <th>IDs / Link</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div style="margin-top:12px" class="d-flex justify-content-between align-items-center">
            <div class="small-muted">Data shown is aggregated (monthly/total) — privacy-first.</div>
            <div>
              <button class="btn btn-sm btn-primary" id="btn-add-manual">Add Manual Entry</button>
              <button class="btn btn-sm btn-outline-light btn-ghost" id="btn-copy-summary">Copy Summary</button>
            </div>
          </div>
        </div>

        <!-- RAW JSON EDITOR -->
        <div class="card-panel" style="margin-top:14px">
          <div class="section-title">Data Studio (Edit / Paste JSON)</div>
          <textarea id="jsonEditor" style="width:100%;height:160px;background:transparent;border:1px solid rgba(255,255,255,0.03);padding:12px;border-radius:8px;color:#eaf6ff" placeholder='Paste or edit JSON data here (press "Apply Data")'></textarea>
          <div style="margin-top:8px;display:flex;gap:8px">
            <button id="btn-apply-json" class="btn btn-success btn-sm">Apply Data</button>
            <button id="btn-reset-sample" class="btn btn-sm btn-outline-light btn-ghost">Reset Sample</button>
            <button id="btn-generate-sim" class="btn btn-sm btn-outline-light btn-ghost">Generate Randomizer</button>
          </div>
        </div>

      </div>

    </div>

    <div class="footer-note">Tip: Replace cover & avatar images (top-left) with your assets. Use the JSON editor to load your exact game IDs / levels. This single page intentionally avoids daily recent activity — it only shows aggregated experience.</div>
  </div>

  <!-- ---------- SCRIPTS: data, rendering, charts, exports ---------- -->
  <script>
    // ---------------- SAMPLE DATA (you can replace via JSON editor)
    const SAMPLE = [
      {
        id: "coc_th15",
        name: "Clash of Clans",
        genre: "Strategy",
        platforms: ["Android","iOS"],
        banner: "#",
        playtimeHours: 1240,
        level: "Town Hall 15",
        achievements: ["Legend League","Maxed Heroes","2k+ Wins"],
        profile: "#",
        notes: "Clan leader, builder base master",
        monthly: [30,25,40,50,45,60,55,70,80,100,100,125] // last 12 months
      },
      {
        id: "ff_lv55",
        name: "Free Fire",
        genre: "Battle Royale",
        platforms: ["Android"],
        banner: "#",
        playtimeHours: 460,
        level: "Lv 55 • Heroic",
        achievements: ["Top100 Season","500 Kills"],
        profile: "#",
        notes: "Solo queue specialist",
        monthly: [5,10,8,12,18,20,25,30,40,45,60,147]
      },
      {
        id: "mc_survival",
        name: "Minecraft",
        genre: "Sandbox",
        platforms: ["PC","Console"],
        banner: "#",
        playtimeHours: 280,
        level: "Survival Specialist",
        achievements: ["Builder Master","Redstone Pro"],
        profile: "#",
        notes: "Redstone & map maker",
        monthly: [10,5,7,12,8,20,22,18,25,20,40,93]
      },
      {
        id: "valorant_immortal",
        name: "Valorant",
        genre: "Tactical Shooter",
        platforms: ["PC"],
        banner: "#",
        playtimeHours: 150,
        level: "Immortal",
        achievements: ["Ace Master","Ranked Climber"],
        profile: "#",
        notes: "Duo queue flex",
        monthly: [2,3,4,8,10,15,18,20,25,20,15,30]
      }
    ];

    // Runtime data object
    let DATA = JSON.parse(JSON.stringify(SAMPLE)); // clone
    let showRawNumbers = false; // toggle

    // Helpers
    const fmt = n => (typeof n === 'number' ? n.toLocaleString() : n);

    // ---------- RENDER UI ----------
    function computeAggregates(data){
      const totalHours = data.reduce((s,g)=>s + (g.playtimeHours || 0), 0);
      const avg = data.length ? Math.round(totalHours / data.length) : 0;
      // genre aggregation
      const genreMap = {};
      data.forEach(g => {
        genreMap[g.genre] = (genreMap[g.genre] || 0) + (g.playtimeHours || 0);
      });
      const topGenre = Object.entries(genreMap).sort((a,b)=>b[1]-a[1])[0];
      return { totalHours, avg, topGenre: topGenre ? topGenre[0] : "-", genreMap };
    }

    function renderSummary(){
      const agg = computeAggregates(DATA);
      document.getElementById('ui-total-hours').innerText = fmt(agg.totalHours);
      document.getElementById('ui-games-count').innerText = DATA.length;
      document.getElementById('ui-top-genre').innerText = agg.topGenre;
      document.getElementById('ui-average-hours').innerText = fmt(agg.avg);
    }

    // Top games list
    function renderTopGames(){
      const container = document.getElementById('top-games-list');
      container.innerHTML = '';
      const sorted = DATA.slice().sort((a,b)=> (b.playtimeHours||0) - (a.playtimeHours||0)).slice(0,6);
      sorted.forEach(g => {
        const card = document.createElement('div');
        card.className = 'game-card';
        card.innerHTML = `
          <div class="game-thumb" style="background-image:url('${g.banner}');"></div>
          <div class="game-meta">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div style="font-weight:700">${g.name}</div>
                <div class="small-muted">${g.genre} • ${g.platforms.join(', ')}</div>
              </div>
              <div style="text-align:right">
                <div class="badge-small">${fmt(g.playtimeHours)} hrs</div>
                <div style="margin-top:6px" class="small-muted">${g.level}</div>
              </div>
            </div>
            <div style="margin-top:8px">${g.achievements.map(a=>`<span class="chip">${a}</span>`).join('')}</div>
          </div>
        `;
        container.appendChild(card);
      });

      // platform links aggregated
      const links = DATA.map(g => `<div><strong>${g.name}</strong>: <a href="${g.profile}" target="_blank" class="small-muted">${g.profile}</a></div>`).join('');
      document.getElementById('platform-links').innerHTML = links;
    }

    // Achievements cloud
    function renderAchievementsCloud(){
      const cloud = document.getElementById('achievements-cloud');
      cloud.innerHTML = '';
      const all = new Set();
      DATA.forEach(g => (g.achievements||[]).forEach(a => all.add(a)));
      Array.from(all).slice(0,60).forEach(a => {
        const el = document.createElement('div'); el.className = 'chip'; el.innerText = a;
        cloud.appendChild(el);
      });
    }

    // ---------- TABLE ----------
    function renderTable(){
      const tbody = document.querySelector('#games-table tbody');
      tbody.innerHTML = '';
      DATA.forEach((g, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>
            <div style="display:flex;gap:10px;align-items:center">
              <div class="game-thumb" style="background-image:url('${g.banner}');width:76px;height:48px"></div>
              <div>
                <div style="font-weight:700">${g.name}</div>
                <div class="small-muted">${g.notes || ''}</div>
              </div>
            </div>
          </td>
          <td>${g.level}</td>
          <td>${(g.achievements||[]).slice(0,5).map(a=>`<span class="chip">${a}</span>`).join('')}</td>
          <td><span class="raw-number">${fmt(g.playtimeHours)}</span></td>
          <td>
            <div style="display:flex;gap:8px;align-items:center">
              <a href="${g.profile}" target="_blank" class="pill-small small-muted">Open Profile</a>
              <button class="btn btn-sm btn-outline-light copy-small" data-idx="${idx}"><i class="fa fa-copy"></i> Copy ID</button>
            </div>
          </td>
        `;
        // collapsible extra row
        tbody.appendChild(tr);

        const tr2 = document.createElement('tr');
        tr2.innerHTML = `<td colspan="5" class="small-muted" style="background:rgba(255,255,255,0.01)"><strong>Monthly breakdown:</strong>
           <div id="mini-monthly-${idx}" style="height:40px;margin-top:8px"></div></td>`;
        tbody.appendChild(tr2);

        // render small sparkline later
      });

      // attach copy listeners
      document.querySelectorAll('.copy-small').forEach(btn => {
        btn.addEventListener('click', (ev) => {
          const idx = +ev.currentTarget.dataset.idx;
          const text = DATA[idx].id || DATA[idx].profile || DATA[idx].name;
          navigator.clipboard.writeText(text || '').then(() => {
            ev.currentTarget.innerHTML = '<i class="fa fa-check"></i> Copied';
            setTimeout(()=> ev.currentTarget.innerHTML = '<i class="fa fa-copy"></i> Copy ID', 1100);
          });
        });
      });

      // mini monthly charts
      DATA.forEach((g, idx) => {
        const d = (g.monthly || []);
        const ctx = document.getElementById(`mini-monthly-${idx}`);
        if (!ctx) return;
        // create small sparkline using Chart.js
        const canvas = document.createElement('canvas');
        canvas.height = 40;
        ctx.appendChild(canvas);
        new Chart(canvas.getContext('2d'), {
          type: 'line',
          data: { labels: d.map((_,i)=>i+1), datasets: [{ data: d, tension: 0.4, borderWidth: 1.2, borderColor: 'rgba(124,92,255,0.92)', fill:false, pointRadius:0 }] },
          options: { plugins:{legend:{display:false}}, scales:{x:{display:false}, y:{display:false}}, elements:{line:{borderWidth:1.5}}, responsive:true, maintainAspectRatio:false }
        });
      });
    }

    // ---------- CHARTS ----------
    let hoursBarChart, monthlyLineChart, genreDonutChart;
    function renderCharts(){
      // Bar: hours per game
      const ctxBar = document.getElementById('hoursBar').getContext('2d');
      const labels = DATA.map(g => g.name);
      const hours = DATA.map(g => g.playtimeHours);
      if (hoursBarChart) hoursBarChart.destroy();
      hoursBarChart = new Chart(ctxBar, {
        type: 'bar',
        data: { labels, datasets: [{ label: 'Hours', data: hours, backgroundColor: labels.map((_,i)=> `rgba(${30+i*30%200},${120},${200-(i*20)%150},0.85)`)}] },
        options: { plugins:{legend:{display:false}}, scales:{x:{ticks:{color:'#dfeeff'}}, y:{beginAtZero:true, ticks:{color:'#dfeeff'}}}, responsive:true }
      });

      // Monthly line: aggregate months across games
      const monthlySum = new Array(12).fill(0);
      DATA.forEach(g => (g.monthly || []).forEach((m,i)=> monthlySum[i] += m));
      const ctxLine = document.getElementById('monthlyLine').getContext('2d');
      if (monthlyLineChart) monthlyLineChart.destroy();
      monthlyLineChart = new Chart(ctxLine, {
        type: 'line',
        data: { labels: ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"], datasets: [{ label: 'Monthly hours (sum)', data: monthlySum, borderColor: 'rgba(57,255,20,0.95)', tension:0.3, fill:true, backgroundColor: 'rgba(57,255,20,0.06)'}] },
        options: { plugins:{legend:{display:false}}, scales:{x:{ticks:{color:'#dfeeff'}}, y:{ticks:{color:'#dfeeff'}}}, responsive:true }
      });

      // Genre donut
      const genreMap = {};
      DATA.forEach(g => genreMap[g.genre] = (genreMap[g.genre]||0) + (g.playtimeHours||0));
      const ctxDonut = document.getElementById('genreDonut').getContext('2d');
      if (genreDonutChart) genreDonutChart.destroy();
      genreDonutChart = new Chart(ctxDonut, {
        type: 'doughnut',
        data: { labels: Object.keys(genreMap), datasets: [{ data: Object.values(genreMap), backgroundColor: ['#7c5cff','#39ff14','#00bcd4','#ffb86b','#ff6b6b'] }] },
        options: { plugins:{legend:{position:'bottom',labels:{color:'#dfeeff'}}}, responsive:true }
      });
    }

    // ---------- EXPORTS ----------
    function exportJSON(){
      const blob = new Blob([JSON.stringify(DATA, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'gaming-data.json'; a.click(); URL.revokeObjectURL(url);
    }
    function exportCSV(){
      const keys = ['id','name','genre','platforms','level','playtimeHours','profile','notes'];
      const rows = [keys.join(',')];
      DATA.forEach(g => rows.push(keys.map(k => {
        let v = g[k];
        if (Array.isArray(v)) v = v.join(';');
        if (v === undefined) v = '';
        return `"${String(v).replace(/"/g,'""')}"`;
      }).join(',')));
      const blob = new Blob([rows.join('\n')], {type: 'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'gaming-data.csv'; a.click(); URL.revokeObjectURL(url);
    }

    // ---------- INTERACTIONS ----------
    function applyData(newData){
      DATA = JSON.parse(JSON.stringify(newData)); // clone
      renderAll();
    }

    function renderAll(){
      renderSummary();
      renderTopGames();
      renderAchievementsCloud();
      renderTable();
      renderCharts();
      // update JSON editor
      document.getElementById('jsonEditor').value = JSON.stringify(DATA, null, 2);
      // hide/show numbers
      toggleRawNumbers(showRawNumbers);
    }

    function toggleRawNumbers(show){
      showRawNumbers = !!show;
      const wrap = document.getElementById('table-wrap');
      if (show){
        wrap.classList.remove('hidden-numbers');
        document.getElementById('toggleRaw').checked = true;
        document.querySelectorAll('.raw-number').forEach(el => el.style.filter = 'none');
      } else {
        wrap.classList.add('hidden-numbers');
        document.getElementById('toggleRaw').checked = false;
        document.querySelectorAll('.raw-number').forEach(el => el.style.filter = 'blur(6px)');
      }
    }

    // ---------- UI: manual entry / generate random ----------
    function addManualEntry(){
      const name = prompt('Game name (e.g. Doom Eternal):');
      if (!name) return;
      const hours = parseInt(prompt('Total hours (number):','100'),10) || 0;
      const obj = {
        id: name.toLowerCase().replace(/\s+/g,'_') + '_' + Math.floor(Math.random()*9999),
        name, genre: 'Unknown', platforms: ['PC'], banner:'#', playtimeHours: hours, level: '—', achievements: [], profile:'#', notes:'Manual entry', monthly: new Array(12).fill(Math.round(hours/12))
      };
      DATA.push(obj);
      renderAll();
    }

    function generateRandomizer(){
      // Slightly randomize monthly distributions to create richer charts
      DATA.forEach(g => {
        g.monthly = g.monthly.map(m => Math.max(0, Math.round(m * (0.7 + Math.random()*0.8))));
        g.playtimeHours = g.monthly.reduce((s,x)=>s+x,0);
      });
      renderAll();
    }

    // ---------- EVENTS ----------
    document.getElementById('btn-load-sample').addEventListener('click', () => { DATA = JSON.parse(JSON.stringify(SAMPLE)); renderAll(); });
    document.getElementById('btn-export-json').addEventListener('click', exportJSON);
    document.getElementById('btn-export-csv').addEventListener('click', exportCSV);
    document.getElementById('btn-apply-json').addEventListener('click', () => {
      const txt = document.getElementById('jsonEditor').value;
      try { const parsed = JSON.parse(txt); applyData(parsed); alert('Data applied'); } catch(e) { alert('Invalid JSON'); }
    });
    document.getElementById('btn-reset-sample').addEventListener('click', () => { DATA = JSON.parse(JSON.stringify(SAMPLE)); renderAll(); });
    document.getElementById('btn-generate-sim').addEventListener('click', () => { generateRandomizer(); alert('Randomized monthly distributions applied'); });
    document.getElementById('toggleRaw').addEventListener('change', (e) => toggleRawNumbers(e.target.checked));
    document.getElementById('btn-add-manual').addEventListener('click', addManualEntry);
    document.getElementById('btn-copy-summary').addEventListener('click', () => {
      const agg = computeAggregates(DATA);
      const txt = `Gaming summary — Total hours: ${agg.totalHours} hrs. Games: ${DATA.map(d=>d.name).join(', ')}.`;
      navigator.clipboard.writeText(txt).then(()=> alert('Summary copied to clipboard'));
    });
    document.getElementById('btn-collapse-all').addEventListener('click', () => {
      // simple visual collapse: hide monthly rows
      document.querySelectorAll('#games-table tbody tr:nth-child(2n)').forEach(r=> r.style.display='none');
    });
    document.getElementById('btn-expand-all').addEventListener('click', () => {
      document.querySelectorAll('#games-table tbody tr').forEach(r=> r.style.display='table-row');
    });

    // ---------- INIT ----------
    (function init(){
      document.getElementById('jsonEditor').value = JSON.stringify(DATA, null, 2);
      renderAll();
      // default hide raw numbers
      toggleRawNumbers(false);
    })();
  </script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>